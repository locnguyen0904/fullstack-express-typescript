FROM node:22.12-alpine

# Set working directory
WORKDIR /home/app/backend-template

# Create non-root user and set permissions
RUN addgroup -g 1001 app && \
    adduser -u 1001 -G app -h /home/app -D app && \
    chown -R app:app /home/app

# Switch to non-root user
USER app

# Copy package files first for better caching
COPY --chown=app:app backend/package*.json ./

# Install dependencies
RUN npm install

# Command is usually overridden in docker-compose for dev
CMD ["npm", "run", "dev"]