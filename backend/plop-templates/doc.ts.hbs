import { z } from 'zod';

import { idParamSchema, listQuerySchema } from '@/common';
import {
  dataResponseSchema,
  errorResponseSchema,
  listResponseSchema,
} from '@/common';
import { registry } from '@/config/openapi.config';

import { create{{pascalCase name}}Schema, update{{pascalCase name}}Schema } from './{{kebabCase name}}.validation';

const bearerAuth = registry.registerComponent('securitySchemes', 'bearerAuth', {
  type: 'http',
  scheme: 'bearer',
  bearerFormat: 'JWT',
});

const security = [{ [bearerAuth.name]: [] }];

// GET /
registry.registerPath({
  method: 'get',
  path: '/{{kebabCase name}}s',
  tags: ['{{pascalCase name}}s'],
  summary: 'Get all {{camelCase name}}s',
  request: {
    query: listQuerySchema,
  },
  responses: {
    200: {
      description: 'List of {{camelCase name}}s',
      content: {
        'application/json': {
          schema: listResponseSchema(create{{pascalCase name}}Schema),
        },
      },
    },
  },
});

// GET /:id
registry.registerPath({
  method: 'get',
  path: '/{{kebabCase name}}s/{id}',
  tags: ['{{pascalCase name}}s'],
  summary: 'Get a {{camelCase name}} by ID',
  request: {
    params: idParamSchema,
  },
  responses: {
    200: {
      description: '{{pascalCase name}} details',
      content: {
        'application/json': {
          schema: dataResponseSchema(
            create{{pascalCase name}}Schema.extend({ _id: z.string() })
          ),
        },
      },
    },
    404: {
      description: '{{pascalCase name}} not found',
      content: {
        'application/json': {
          schema: errorResponseSchema,
        },
      },
    },
  },
});

// POST /
registry.registerPath({
  method: 'post',
  path: '/{{kebabCase name}}s',
  tags: ['{{pascalCase name}}s'],
  summary: 'Create a new {{camelCase name}}',
  security,
  request: {
    body: {
      content: {
        'application/json': {
          schema: create{{pascalCase name}}Schema,
        },
      },
    },
  },
  responses: {
    201: {
      description: '{{pascalCase name}} created successfully',
      content: {
        'application/json': {
          schema: dataResponseSchema(
            create{{pascalCase name}}Schema.extend({ _id: z.string() })
          ),
        },
      },
    },
    401: {
      description: 'Unauthorized',
      content: {
        'application/json': {
          schema: errorResponseSchema,
        },
      },
    },
    403: {
      description: 'Forbidden - Admin only',
      content: {
        'application/json': {
          schema: errorResponseSchema,
        },
      },
    },
  },
});

// PUT /:id
registry.registerPath({
  method: 'put',
  path: '/{{kebabCase name}}s/{id}',
  tags: ['{{pascalCase name}}s'],
  summary: 'Update a {{camelCase name}}',
  security,
  request: {
    params: idParamSchema,
    body: {
      content: {
        'application/json': {
          schema: update{{pascalCase name}}Schema,
        },
      },
    },
  },
  responses: {
    200: {
      description: '{{pascalCase name}} updated successfully',
      content: {
        'application/json': {
          schema: dataResponseSchema(
            create{{pascalCase name}}Schema.extend({ _id: z.string() })
          ),
        },
      },
    },
    401: {
      description: 'Unauthorized',
      content: {
        'application/json': {
          schema: errorResponseSchema,
        },
      },
    },
    403: {
      description: 'Forbidden - Admin only',
      content: {
        'application/json': {
          schema: errorResponseSchema,
        },
      },
    },
    404: {
      description: '{{pascalCase name}} not found',
      content: {
        'application/json': {
          schema: errorResponseSchema,
        },
      },
    },
  },
});

// DELETE /:id
registry.registerPath({
  method: 'delete',
  path: '/{{kebabCase name}}s/{id}',
  tags: ['{{pascalCase name}}s'],
  summary: 'Soft delete a {{camelCase name}}',
  description: 'Marks the {{camelCase name}} as deleted without removing it from storage.',
  security,
  request: {
    params: idParamSchema,
  },
  responses: {
    200: {
      description: '{{pascalCase name}} deleted successfully',
      content: {
        'application/json': {
          schema: dataResponseSchema(
            create{{pascalCase name}}Schema.extend({ _id: z.string() })
          ),
        },
      },
    },
    401: {
      description: 'Unauthorized',
      content: {
        'application/json': {
          schema: errorResponseSchema,
        },
      },
    },
    403: {
      description: 'Forbidden - Admin only',
      content: {
        'application/json': {
          schema: errorResponseSchema,
        },
      },
    },
    404: {
      description: '{{pascalCase name}} not found',
      content: {
        'application/json': {
          schema: errorResponseSchema,
        },
      },
    },
  },
});
