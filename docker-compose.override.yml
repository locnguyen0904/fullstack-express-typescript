volumes:
  backend_node_modules:
    labels:
      com.backend-template.description: "Backend node_modules cache"
      com.backend-template.backup-priority: "none"
      com.backend-template.environment: "development"
  frontend_node_modules:
    labels:
      com.backend-template.description: "Frontend node_modules cache"
      com.backend-template.backup-priority: "none"
      com.backend-template.environment: "development"

services:
  mongo:
    container_name: backend-template_mongo
    environment:
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_INITDB_ROOT_PASSWORD:-password123}
    ports:
      - "27017:27017"

  redis:
    container_name: backend-template_redis
    ports:
      - "6379:6379"

  backend:
    container_name: backend-template_backend
    build:
      target: development
    env_file:
      - .env
    ports:
      - "3000:3000"
      - "9229:9229"
    volumes:
      - ./backend:/home/app/backend-template
      - backend_node_modules:/home/app/backend-template/node_modules

  frontend:
    container_name: backend-template_frontend
    build:
      target: development
    ports:
      - "3001:3000"
    volumes:
      - ./frontend:/home/app/client
      - frontend_node_modules:/home/app/client/node_modules
    environment:
      VITE_API_URL: ${VITE_API_URL:-http://localhost:3000}
    stdin_open: true
    tty: true
